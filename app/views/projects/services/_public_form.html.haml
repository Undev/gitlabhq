%h3.page-title
  - if @service.enabled?
    %span.cgreen
      %i.icon-circle
  - else
    %span.cgray
      %i.icon-circle-blank
  = @service.title

%p= @service.description

.back-link
  = link_to project_services_path(@project) do
    &larr; to services

%hr

= form_for(@service, as: :service, url: project_service_path(@project, @service.to_param), method: :put) do |f|
  - if @service.errors.any?
    .alert.alert-error
      %ul
        - @service.errors.full_messages.each do |msg|
          %li= msg


  .control-group
    = f.label :state_event, "Enable state", class: "control-label"
    .controls
      = f.select(:state_event, @service.state_transitions.map {|s| [s.human_event, s.event]}, include_blank: @service.human_state_name)

  - if @service.respond_to?(:configuration)
    - configuration = @service.configuration
    = f.fields_for :configuration, configuration do |config|
      - @service.fields.each do |field|
        - name = field[:name]
        - type = field[:type]
        - placeholder = field[:placeholder]

        .control-group
          = config.label name, class: "control-label"
          .controls
            - if type == 'text'
              = config.text_field name, class: "input-xlarge", placeholder: placeholder, disabled: true
            - elsif type == 'checkbox'
              = config.check_box name, disabled: true

  = f.fields_for :service_key_service_relationships do |sksr|
    = render "service_key_service_relationships", f: sksr

  .form-actions
    = f.submit 'Save', class: 'btn btn-save'
    &nbsp;
    - if @service.valid? && @service.activated? && @service.can_test?
      = link_to 'Test settings', test_project_service_path(@project, @service), class: 'btn btn-small'
